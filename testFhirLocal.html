<!DOCTYPE html>
<html>

<head>
    <title>My FHIR-based questionnaire form</title>
</head>

<body>
    <h1>My FHIR-based questionnaire form</h1>
    <form id="questionnaire-form">
        <label for="question-1">Have you fallen in the past year?</label>
        <input type="radio" name="question-1" value="yes">Yes<br>
        <input type="radio" name="question-1" value="no">No<br>
        <label for="question-2">Have you talked to a doctor about falling in the past year?</label>
        <input type="radio" name="question-2" value="yes">Yes<br>
        <input type="radio" name="question-2" value="no">No<br>
        <button type="submit">Submit</button>
    </form>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        const baseURL = "http://localhost:8080/fhir/";
        // Submit the form data as a QuestionnaireResponse resource to the FHIR server
        $("#questionnaire-form").on("submit", function (e) {
            e.preventDefault();

            // Construct the QuestionnaireResponse resource from the form data
            var questionnaireResponse = {
                resourceType: "QuestionnaireResponse",
                questionnaire: baseURL + "10060625",
                id: "10060629",
                status: "completed",
                subject: {
                    reference: "Patient/10060627"
                },
                item: [
                    {
                        linkId: "1",
                        answer: [
                            {
                                valueCoding: {
                                    code: $("input[name='question-1']:checked").val()
                                }
                            }
                        ]
                    },
                    {
                        linkId: "2",
                        answer: [
                            {
                                valueCoding: {
                                    code: $("input[name='question-2']:checked").val()
                                }
                            }
                        ]
                    }
                ]
            };

            // Send a POST request to the server"s QuestionnaireResponse endpoint to create the resource
            $.ajax({
                url: "https://hapi.fhir.org/baseR4/QuestionnaireResponse/10060629",
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify(questionnaireResponse),
                success: function (response) {
                    console.log("Questionnaire response submitted successfully!");
                },
                error: function (error) {
                    console.log("Error submitting questionnaire response: " + error.responseText);
                }
            });
        });

        // Get a list of all QuestionnaireResponse resources for a specific patient from the FHIR server
        $.ajax({
            url: "https://hapi.fhir.org/baseR4/QuestionnaireResponse?subject=10060627",
            type: "GET",
            success: function (response) {
                console.log("QuestionnaireResponse resources:");
                response.entry.forEach(function (entry) {
                    console.log("Resource ID:", entry.resource.id);
                    console.log("Question 1:", entry.resource.item[0].answer[0].valueCoding.code);
                    console.log("Question 2:", entry.resource.item[1].answer[0].valueCoding.code);
                });
            },
            error: function (error) {
                console.log("Error getting questionnaire responses:", error);
            }
        });

    </script>
</body>

</html>